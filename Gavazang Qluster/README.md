
# راهنمای استفاده از کلاستر Gavazang در IASBS
سرور Gavazang یک کلاستر محاسباتی (HPC Cluster) در IASBS است که برای انجام محاسبات سنگین و پردازش‌های علمی استفاده می‌شود. این سرور با سیستم‌عامل Qlustar 12 (بر پایه Ubuntu 20.04) اجرا می‌شود و شامل 15 نود محاسباتی با سخت‌افزارهای مختلف است. 


http://192.168.194.137/


## **۱. اتصال به سرور (Login)**
برای متصل شدن به کلاستر Gavazang، باید از **SSH** استفاده کنید. این کار را می‌توان با دستور زیر انجام داد:
```bash
ssh username@192.168.194.137
```
🔹 در اینجا **username** نام کاربری شما روی سرور است. پس از اجرای این دستور، از شما **رمز عبور** خواسته می‌شود. بعد از وارد کردن رمز، شما به سرور متصل خواهید شد.

---

## **۲. مشاهده وضعیت کلاستر**
اگر بخواهید وضعیت نودهای سرور را ببینید (برای بررسی وضعیت بار پردازشی و انتخاب بهترین نود)، می‌توانید از لینک زیر استفاده کنید:
```
http://192.168.194.137/ganglia/
```
این صفحه شامل اطلاعاتی درباره **استفاده از CPU، حافظه، و وضعیت نودها** است.

---

## **۳. مدیریت محیط (Environment Modules)**
سرور Gavazang از **ماژول‌های محیطی (Environment Modules)** برای مدیریت نرم‌افزارهای نصب‌شده استفاده می‌کند. این ماژول‌ها به شما کمک می‌کنند که به‌راحتی نرم‌افزارهای موردنیاز را بارگذاری کنید.

### **دستورات اصلی:**
✅ لیست ماژول‌های موجود:
```bash
module avail
```
✅ لیست ماژول‌های بارگذاری‌شده:
```bash
module list
```
✅ بارگذاری یک ماژول:
```bash
module load module_name
```
✅ حذف یک ماژول:
```bash
module unload module_name
```
✅ تغییر از یک ماژول به ماژول دیگر:
```bash
module switch module_name1 module_name2
```
❗ توجه: دستورات `module unload` و `module switch` ممکن است همیشه به‌درستی کار نکنند.

### **ماژول‌های مهم:**
- **Anaconda/Anaconda3** → اجرای پایتون و کتابخانه‌های علمی
- **Matlab/R2021b** → اجرای متلب
- **Mathematica/13.0** → اجرای ماتماتیکا
- **compiler/latest** → شامل کامپایلرهای C/C++ و Fortran از اینتل

📌 مثال: اگر بخواهید کامپایلر اینتل را فعال کنید، از این دستور استفاده کنید:
```bash
module load compiler/latest
```
پس از این کار، می‌توانید از کامپایلرهای `icc` و `ifort` استفاده کنید.

---

## **۴. اجرای کد با SLURM**

سیستم SLURM یک سیستم مدیریت کارها (Job Scheduler) است که برای ارسال و اجرای کدها روی نودهای سرور استفاده می‌شود. 

برای اجرای یک کد، باید یک **اسکریپت بچ (Batch Script)** بنویسید و آن را با `sbatch` ارسال کنید.

📌 **نمونه اسکریپت SLURM برای اجرای یک Job:**
فایلی با نام job_script.sh ایجاد کنید و محتوای زیر را در آن قرار دهید:


```bash
#!/bin/bash                                                          
#SBATCH --partition=regular      # ارسال به پارتیشن regular
#SBATCH --job-name=my_job        # نام Job
#SBATCH --cpus-per-task=1        # تعداد CPU برای هر Task
#SBATCH --nodes=1                # تعداد نودها
#SBATCH --ntasks-per-node=1      # تعداد تسک در هر نود
#SBATCH --time=100:00:00         # حداکثر زمان اجرا (100 ساعت)
#SBATCH --mem=24000              # مقدار RAM در MB

echo "Job started on $(hostname)"
python my_script.py              # اجرای کد پایتون
```
### ** نحوه اجرای Job**
بعد از نوشتن این اسکریپت، آن را با دستور زیر روی سرور اجرا کنید:

```bash
sbatch job_script.sh
```

پس از ارسال، SLURM یک شناسه کار (Job ID) اختصاص می‌دهد. مثلا:

```bash
Submitted batch job 123
```
این عدد ۱۲۳ شناسه‌ی کار شماست که برای بررسی وضعیت آن به کار می‌رود.

---

## **۵. بررسی وضعیت Jobs**
✅ مشاهده وضعیت همه‌ی Jobها:
```bash
squeue
```
✅ مشاهده **فقط** کارهای شما:
```bash
squeue -u username
```
✅ مشاهده **فقط کارهای در حال اجرا**:
```bash
squeue -u username -t RUNNING
```
✅ مشاهده **فقط کارهای منتظر اجرا**:
```bash
squeue -u username -t PENDING
```

---

## **۶. لغو کردن Job**
✅ لغو یک Job خاص:
```bash
scancel job_id
```
✅ لغو **همه‌ی Jobهای شما**:
```bash
scancel -u username
```
✅ لغو **فقط Jobهای منتظر اجرا**:
```bash
scancel -t PENDING -u username
```

---

## **۷. پارتیشن‌های مختلف سرور**
| **نام پارتیشن** | **نودها** | **حداکثر زمان اجرا** | **ویژگی خاص** |
|---------------|----------|-----------------|--------------|
| **regular**   | psm01-15 | 2 روز          | همه نودها در دسترس |
| **long**      | psm01-04 | 7 روز          | مناسب برای کارهای زمان‌بر |
| **xlong**     | psm05    | 15 روز         | مخصوص کارهای خیلی طولانی |
| **large**     | psm06-12 | 3 روز          | مخصوص کارهای با RAM بالا (تا 128GB) |
| **xlarge**    | psm13-15 | 3 روز          | مخصوص کارهای با RAM بسیار بالا (تا 256GB) |

🔹 هنگام اجرای Job، می‌توانید پارتیشن موردنظر را مشخص کنید. مثلا اگر کار شما به حافظه‌ی زیادی نیاز دارد، بهتر است آن را روی پارتیشن large یا xlarge اجرا کنید.



🔹 مثال برای اجرای Job در پارتیشن `long`:
```bash
#SBATCH --partition=long
```

---

## **جمع‌بندی**
✅ اتصال به سرور:
```bash
ssh username@192.168.194.137
```
✅ بارگذاری نرم‌افزارها:
```bash
module load module_name
```
✅ ارسال Job:
```bash
sbatch job_script.sh
```
✅ بررسی وضعیت Jobها:
```bash
squeue -u username
```
✅ لغو Job:
```bash
scancel job_id
```
✅ انتخاب پارتیشن مناسب:
- **regular** (۲ روز) → کارهای معمولی  
- **long** (۷ روز) → کارهای زمان‌بر  
- **xlong** (۱۵ روز) → کارهای خیلی طولانی  
- **large** (۳ روز) → کارهای با حافظه زیاد  
- **xlarge** (۳ روز) → کارهای با حافظه بسیار زیاد  

---

📌 **سوالات متداول:** اگر سوالی دارید، لطفاً با مدیر سیستم یا راهنمای `man` در ترمینال مشورت کنید.

```bash
man sbatch
```

📢 **نکته:** لطفاً همیشه قبل از اجرای Job، وضعیت کلاستر را بررسی کنید تا از اجرای بهینه‌ی کارهای خود اطمینان حاصل کنید.

📢 سایت فقط از طریق شبکه دانشگاه قابل دسترسی است. سیستم مدیریت صف اجرای جاب ها slurm هست و هرگونه برنامه ای برای اجرا بر روی کلاستر باید از طریق صف اجرا ارسال شود. شیوه ساختن فایل جاب و ارسال در سایت راهنمای کلاستر موجود است. فقط یک نکته که هد نود کلاستر یک کامپیوتر خیلی قدیمی ضعیف است و تنها باید برای آماده سازی و نهایتا کامپایل برنامه ها قبل از اجرا استفاده شود و برنامه ای نباید مستقیم بر روی هد نود اجرا شود چرا که به دلیل رم و سی پیو ضعیف و اندک هدنود ممکن است هنگ کند. همچنین هر برنامه ای که در لیست ماژول های کلاستر موجود نبود را می توانید در هوم فولدر خود به صورت لوکال و بدون دسترسی ادمین نصب و استفاده کنید.

